{% load i18n %}
{% load l10n %}
{% load stats %}
<div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">{{ challenge.nom }}</h3>
    </div>
    <div class="panel-body">
        <div class="media">
            <div class="media-left">
                <img src="{{ MEDIA_URL }}{{ challenge.logo }}" align="left" width="200" />
            </div>
            <div class="media-body">
                <p>{% trans "Vous participez au challenge." %}</p>
                <p>{% trans "Le challenge comporte les courses suivantes :" %}</p>
                <div class="row equal">
                    {% for course in challenge.courses.all %}
                    {% if course != COURSE %}
                    <div class="col-md-4">
                        <div class="thumbnail">
                            <a href="{{ course.url }}" style="background: url({{ MEDIA_URL }}{{ course.logo }}) no-repeat 50% 50%; background-size: contain; height: 200px; width: 100%; display: block"></a>
                            <div class="caption">
                                <h3><a href="{{ course.url }}">{{ course.nom }}</a></h3>
                                <p>
                                    {% blocktrans with date=course.date ville=course.ville %}le {{date }} à {{ ville }}{% endblocktrans %}<br />
                                    {% blocktrans with organisateur=course.organisateur %}Organisé par {{ organisateur }}.{% endblocktrans %}
                                </p>
                                {% with participation.equipes_dict|get:course.uid as ec2 %}
                                    {% if ec2 %}
                                        <br />
                                        {% if ec2.points %}{% blocktrans with points=ec2.points %}Vous y avez déjà gagné {{ points }} points{% endblocktrans %}
                                        {% else %}{% trans "Vous êtes déjà inscrit" %}{% endif %}
                                    {% else %}
                                        {% if course.fermee %}
                                        <p>
                                            {% blocktrans %}Les inscriptions sont fermées{% endblocktrans %}<br />
                                        </p>
                                        {% else  %}
                                            {% if course.ouverte %}
                                            {% if not create and not update %}
                                            <a class="btn btn-lg btn-block btn-primary" role="button" href="{% url "inscriptions.create" course_uid=course.uid %}?course={{ COURSE.uid }}&numero={{ instance.numero }}&code={{ instance.password }}">{% trans "Inscription" %}</a><br />
                                            {% endif %}
                                            <p>
                                                {% blocktrans with fermeture=course.date_fermeture %}Fermeture des inscriptions le {{ fermeture }}{% endblocktrans %}<br />
                                            </p>
                                            {% else %}
                                            <p>
                                                {% blocktrans with ouverture=course.date_ouverture %}Ouverture des inscriptions le {{ ouverture }}{% endblocktrans %}<br />
                                            </p>
                                            {% endif %}
                                        {% endif %}
                                    {% endif %}
                                {% endwith %}
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

